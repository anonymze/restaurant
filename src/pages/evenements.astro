---
import Layout from "@/layouts/layout.astro";
import EventsCard from "@/components/events-card";
import { sanityClient } from "sanity:client";
import gamePlaceholderImage from "@/assets/images/game-placeholder.webp";
import concertPlaceholderImage from "@/assets/images/concert-placeholder.webp";
import degustationPlaceholderImage from "@/assets/images/degustation-placeholder.webp";
import { getImage } from "astro:assets";
import type { SanityDocument } from "@sanity/client";
import type { Event } from "@/types/event";

const todayDate = new Date().toISOString().split("T")[0];
const EVENT_QUERY = `*[_type == "event" && date >= "${todayDate}"] | order(date asc)`;
const events = await sanityClient.fetch<SanityDocument<Event>[]>(EVENT_QUERY);

const weekEvents = events.filter((event) => event.date.split("T")[0] >= todayDate);
const nextMonthEvents = events.filter((event) => event.date.split("T")[0] >= todayDate);

const gamePlaceholder = await getImage({
	src: gamePlaceholderImage,
	format: "webp",
	width: 450,
	loading: "eager",
});

const concertPlaceholder = await getImage({
	src: concertPlaceholderImage,
	format: "webp",
	width: 450,
	loading: "eager",
});

const degustationPlaceholder = await getImage({
	src: degustationPlaceholderImage,
	format: "webp",
	width: 450,
	loading: "eager",
});
---

<Layout overflow>
	<main class="bg-stone-50 py-16 px-4 md:py-24">
		<section class="container mx-auto max-w-6xl space-y-12" aria-labelledby="events-title">
			<div class="text-center mb-12">
				<h1 id="events-title" class="text-4xl font-serif text-stone-800 mb-4">Nos événements</h1>
				<div class="flex justify-center items-center gap-3 mb-6" role="presentation">
					<div class="h-0.5 w-8 bg-primary" aria-hidden="true"></div>
					<span class="text-sm font-medium uppercase tracking-wider text-primary">
						Des événements pour tous les goûts
					</span>
					<div class="h-0.5 w-8 bg-primary" aria-hidden="true"></div>
				</div>
				<p class="text-lg text-stone-600 max-w-2xl mx-auto leading-relaxed">
					Découvrez nos événements spéciaux et vivez des moments inoubliables.
				</p>
			</div>
		</section>

		<section class="container mx-auto max-w-6xl">
			<EventsCard
				client:load
				events={weekEvents}
				gamePlaceholder={gamePlaceholder}
				concertPlaceholder={concertPlaceholder}
				degustationPlaceholder={degustationPlaceholder}
				titleSection="Évenements de la semaine"
				iconSection="week"
			/>
		</section>

		<section class="container mx-auto max-w-6xl mt-12">
			<EventsCard
				client:load
				events={nextMonthEvents}
				gamePlaceholder={gamePlaceholder}
				concertPlaceholder={concertPlaceholder}
				degustationPlaceholder={degustationPlaceholder}
				titleSection="Évenements à venir"
				iconSection="next"
			/>
		</section>
	</main>
</Layout>

---
import Layout from "@/layouts/layout.astro";
import MenuCard from "@/components/menu-card.tsx";
import { sanityClient } from "sanity:client";
import { Leaf } from "lucide-react";
import type { SanityDocument } from "@sanity/client";
import type { Menu } from "@/types/menu";

// Get today's date in YYYY-MM-DD format
const todayDate = new Date().toISOString().split('T')[0];
const MENU_QUERY = `*[_type == "menu" && date <= "${todayDate}"] | order(date desc)[0]`;
const menu = await sanityClient.fetch<SanityDocument<Menu>>(MENU_QUERY);

const entries = menu.menuItems.filter((item) => item.category === "entry");
const plates = menu.menuItems.filter((item) => item.category === "plate");
const desserts = menu.menuItems.filter((item) => item.category === "dessert");
const current_day = new Intl.DateTimeFormat('fr-FR', { weekday: 'long' }).format(new Date());
---

<Layout overflow>
	<main class="bg-stone-50 py-16 px-4 md:py-24">
		<section class="container mx-auto max-w-6xl space-y-12">
			<div class="text-center mb-12">
				<h1 class="text-4xl font-serif text-stone-800 mb-4">Nos cartes</h1>
				<div class="flex justify-center items-center gap-3 mb-6">
					<div class="h-0.5 w-8 bg-primary" aria-hidden="true"></div>
					<span class="text-sm font-medium uppercase tracking-wider text-primary">
						Un menu différent chaque jour
					</span>
					<div class="h-0.5 w-8 bg-primary" aria-hidden="true"></div>
				</div>
				<p class="text-lg text-stone-600 max-w-2xl mx-auto leading-relaxed">
					Découvrez notre menu du jour, changeant au gré des saisons, accompagné de notre sélection de vins raffinés.
				</p>
			</div>
		</section>

		<article class="container mx-auto max-w-2xl mb-12">
			<p class="my-4 text-sm">
				<span class="font-medium text-red-700">*</span> Signifie une présence d'allergènes.
			</p>
			<MenuCard client:load currentDay={current_day} entries={entries} plates={plates} desserts={desserts} />

			<div class="p-6 shadow-sm border border-tertiary">
				<h3 class="text-xl font-serif text-tertiary mb-4 flex items-center">
					<Leaf className="h-5 w-5 mr-2" />
					Informations sur le menu
				</h3>
				<ul class="space-y-2 text-stone-700 list-disc list-inside">
					<li>Le menu change quotidiennement en fonction des arrivages et de l'inspiration du chef.</li>
					<li>Tous nos plats sont préparés sur place à partir de produits frais et de saison.</li>
					<li>Pour toute allergie ou régime alimentaire spécifique, n'hésitez pas à nous consulter.</li>
					<li>Nous essayons au maximum de proposer des plats végétariens en alternative.</li>
					<li>Le menu du vendredi sera composé de poisson.</li>
				</ul>
			</div>
		</article>
	</main>
</Layout>
